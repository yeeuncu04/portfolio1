<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>ë°›ì€ ë©”ì‹œì§€</title>
  <style>
    body { font-family: sans-serif; background:#f5f7fb; padding:30px; }
    table { width:100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #ccc; padding: 10px; text-align:left; }
    button {
      padding: 6px 10px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #dc2626;
    }
  </style>
</head>
<body>
  <h2>ğŸ“¬ ë°›ì€ ë©”ì‹œì§€</h2>

  <table id="msgTable">
    <tr>
      <th>ID</th>
      <th>ì´ë¦„</th>
      <th>Email</th>
      <th>ë©”ì‹œì§€</th>
      <th>ë‚ ì§œ</th>
      <th>ì‚­ì œ</th>
    </tr>
  </table>

  <script>
    const API_BASE = "https://portfolio1-2-whb2.onrender.com";

    async function loadMessages() {
      const res = await fetch(API_BASE + "/api/messages");
      const data = await res.json();

      const table = document.querySelector("#msgTable");

      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row._id}</td>
          <td>${row.name}</td>
          <td>${row.email}</td>
          <td>${row.message}</td>
          <td>${row.createdAt ? row.createdAt : ""}</td>
          <td><button onclick="deleteMessage('${row._id}')">ì‚­ì œ</button></td>
        `;
        table.appendChild(tr);
      });
    }

    async function deleteMessage(id) {
      if (!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;

      const res = await fetch(API_BASE + `/api/messages/${id}`, {
        method: "DELETE",
      });

      const data = await res.json();
      alert(data.msg);

      // ì‚­ì œ í›„ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
      location.reload();
    }

    loadMessages();
  </script>
</body>
</html>
