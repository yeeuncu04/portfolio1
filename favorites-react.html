<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>êµ°ì‚° ê´€ê´‘ì§€ ì¦ê²¨ì°¾ê¸° (ì°œ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ìŠ¤íƒ€ì¼ -->
  <style>
    :root {
      --mint: #70f7b0;
      --mint-deep: #35d58a;
      --navy: #173b7a;
      --lavender: #f1ecff;
      --chip-bg: #e8f8ff;
      --rank-bg: #faf5ff;
      --card-bg: #ffffff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 24px 12px;
      background: radial-gradient(circle at top left, #f4fff9 0, #f5fbff 40%, #fff5fb 100%);
      color: #222;
    }

    .container {
      max-width: 1080px;
      margin: 0 auto 40px;
      background: var(--card-bg);
      border-radius: 26px;
      padding: 24px 26px 30px;
      box-shadow:
        0 18px 40px rgba(20, 36, 80, 0.12),
        0 0 0 1px rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(154, 180, 214, 0.2);
    }

    /* í—¤ë” */
    h1 {
      margin: 0 0 6px;
      font-size: 1.7rem;
      letter-spacing: 0.03em;
      color: #111827;
    }

    .subtitle {
      margin: 0 0 18px;
      font-size: 0.9rem;
      color: #6b7280;
      line-height: 1.6;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 10px;
      font-size: 0.72rem;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      margin-left: 8px;
      font-weight: 600;
    }

    .tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #4f46e5;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 16px;
      margin-bottom: 10px;
    }

    .header-right {
      font-size: 0.8rem;
      color: #9ca3af;
      text-align: right;
    }

    .header-right strong {
      color: #4b5563;
    }

    /* ì „ì²´ ë ˆì´ì•„ì›ƒ */
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(260px, 1.3fr);
      gap: 18px;
    }

    /* ê´€ê´‘ì§€ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
    .section-title {
      margin: 0 0 6px;
      font-size: 1rem;
      font-weight: 700;
      color: #111827;
    }

    .section-desc {
      margin: 0 0 12px;
      font-size: 0.85rem;
      color: #6b7280;
    }

    .highlight {
      color: var(--navy);
      font-weight: 600;
    }

    .place-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 12px;
    }

    .place-card {
      position: relative;
      border-radius: 18px;
      padding: 12px 12px 12px 14px;
      background: linear-gradient(135deg, #ffffff 0%, #f9feff 100%);
      border: 1px solid rgba(209, 213, 219, 0.7);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow: hidden;
    }

    .place-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 18px;
      background: radial-gradient(circle at top left, rgba(112, 247, 176, 0.14), transparent 50%);
      pointer-events: none;
    }

    .place-name {
      font-weight: 700;
      font-size: 0.96rem;
      color: #111827;
    }

    .place-desc {
      font-size: 0.85rem;
      color: #4b5563;
    }

    .place-meta {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .place-meta .pin {
      margin-right: 3px;
    }

    .place-likes {
      font-size: 0.8rem;
      color: #374151;
      margin-top: 2px;
    }

    .likes-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #047857;
      font-size: 0.78rem;
      font-weight: 600;
    }

    .likes-pill .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #10b981;
    }

    .btn-row {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
      z-index: 1;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.85rem;
      cursor: pointer;
      background: linear-gradient(135deg, var(--mint) 0%, var(--mint-deep) 100%);
      font-weight: 700;
      color: #064e3b;
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.35);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    button span.icon {
      font-size: 1rem;
    }

    button:hover {
      filter: brightness(0.97);
      transform: translateY(-1px);
      box-shadow: 0 9px 20px rgba(34, 197, 94, 0.45);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(34, 197, 94, 0.3);
    }

    button:disabled {
      opacity: 0.65;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    /* ìš°ì¸¡: ë­í‚¹ ì¹´ë“œ */
    .ranking-card {
      border-radius: 20px;
      padding: 14px 16px 16px;
      background: radial-gradient(circle at top right, #fef2ff 0, #f9f5ff 40%, #f5f3ff 100%);
      border: 1px solid rgba(196, 181, 253, 0.7);
      box-shadow: 0 12px 30px rgba(88, 28, 135, 0.12);
      display: flex;
      flex-direction: column;
      min-height: 220px;
    }

    .ranking-title {
      margin: 0 0 4px;
      font-size: 1rem;
      font-weight: 700;
      color: #111827;
    }

    .ranking-sub {
      margin: 0 0 10px;
      font-size: 0.78rem;
      color: #6b7280;
    }

    .ranking-list {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.88rem;
      flex: 1;
    }

    .ranking-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
      border-bottom: 1px dashed rgba(209, 213, 219, 0.7);
    }

    .ranking-item:last-child {
      border-bottom: none;
    }

    .ranking-left {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .rank-badge {
      min-width: 22px;
      height: 22px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.72rem;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
    }

    .rank-1 {
      background: linear-gradient(135deg, #f59e0b, #f97316);
    }

    .rank-2 {
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
    }

    .rank-3 {
      background: linear-gradient(135deg, #22c55e, #16a34a);
    }

    .ranking-count {
      font-size: 0.86rem;
      color: #4c1d95;
      font-weight: 600;
    }

    .ranking-count small {
      font-size: 0.74rem;
      color: #6b21a8;
    }

    .ranking-footer {
      font-size: 0.78rem;
      color: #6b7280;
      margin-top: 8px;
      text-align: right;
    }

    /* ìƒíƒœ ë©”ì‹œì§€ */
    .status {
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .error {
      color: #dc2626;
      font-size: 0.85rem;
      margin-bottom: 6px;
    }

    @media (max-width: 900px) {
      .container {
        padding: 20px 16px 24px;
        border-radius: 20px;
      }

      .header-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .layout {
        grid-template-columns: 1fr;
      }

      .ranking-card {
        order: -1;
      }
    }

    @media (max-width: 640px) {
      body {
        padding: 16px 10px;
      }

      h1 {
        font-size: 1.35rem;
      }

      .place-list {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const API_BASE = "https://portfolio1-2-whb2.onrender.com";

    // êµ°ì‚° ì£¼ìš” ê´€ê´‘ì§€ ëª©ë¡ (ì •ì  ë°ì´í„°)
    const PLACES = [
      {
        id: "shinhung-house",
        name: "ì‹ í¥ë™ ì¼ë³¸ì‹ ê°€ì˜¥",
        desc: "ê·¼ëŒ€ ì¼ë³¸ì‹ ì£¼íƒì´ ì˜ ë³´ì¡´ëœ ê³¨ëª© í’ê²½.",
        area: "ì‹ í¥ë™ ê·¼ëŒ€ë¬¸í™”ê±°ë¦¬",
      },
      {
        id: "modern-museum",
        name: "êµ°ì‚° ê·¼ëŒ€ì—­ì‚¬ë°•ë¬¼ê´€",
        desc: "êµ°ì‚°ì˜ ê·¼ëŒ€ ì—­ì‚¬ì™€ ë¬¸í™”ë¥¼ ì „ì‹œí•˜ëŠ” ëŒ€í‘œ ë°•ë¬¼ê´€.",
        area: "ë‚´í•­ ì¼ëŒ€",
      },
      {
        id: "gyeongam-dong",
        name: "ê²½ì•”ë™ ì² ê¸¸ë§ˆì„",
        desc: "ì˜› ì² ê¸¸ê³¼ ê°ì„± ìˆëŠ” ë²½í™”ë¡œ ìœ ëª…í•œ ë§ˆì„.",
        area: "ê²½ì•”ë™",
      },
      {
        id: "eunpa-lake",
        name: "ì€íŒŒí˜¸ìˆ˜ê³µì›",
        desc: "ì‚°ì±…ë¡œì™€ ì•¼ê²½ì´ ì•„ë¦„ë‹¤ìš´ í˜¸ìˆ˜ê³µì›.",
        area: "ë‚˜ìš´ë™",
      },
      {
        id: "dongguksa",
        name: "ë™êµ­ì‚¬",
        desc: "ì „êµ­ ìœ ì¼ì˜ ì¼ë³¸ì‹ ëª©ì¡°ê±´ì¶• ì‚¬ì°°.",
        area: "ë™êµ­ì‚¬ ì¼ëŒ€",
      },
      {
        id: "wolmyeong-park",
        name: "ì›”ëª…ê³µì›",
        desc: "ì „ë§ëŒ€ì—ì„œ êµ°ì‚° ì‹œë‚´ì™€ ì„œí•´ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆëŠ” ê³µì›.",
        area: "ì›”ëª…ì‚°",
      },
    ];

    function FavoritesApp() {
      const [favorites, setFavorites] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      const totalLikes = favorites.reduce((sum, f) => sum + (f.likes || 0), 0);

      // íƒ­ ì œëª© ë³€ê²½ (BOM í™œìš©)
      React.useEffect(() => {
        document.title = `êµ°ì‚° ê´€ê´‘ì§€ ì¦ê²¨ì°¾ê¸° (${totalLikes}íšŒ ì°œ)`;
      }, [totalLikes]);

      React.useEffect(() => {
        fetchFavorites();
      }, []);

      const fetchFavorites = async () => {
        try {
          setLoading(true);
          setError("");
          const res = await fetch(`${API_BASE}/favorites`);
          if (!res.ok) throw new Error("ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
          const data = await res.json();
          setFavorites(data);
        } catch (e) {
          console.error("GET /favorites error:", e);
          setError("ì¦ê²¨ì°¾ê¸° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì„œë²„/DB í™•ì¸)");
        } finally {
          setLoading(false);
        }
      };

      const getLikesForPlace = (placeName) => {
        const found = favorites.find((f) => f.placeName === placeName);
        return found ? found.likes : 0;
      };

      const handleFavorite = async (place) => {
        try {
          setLoading(true);
          setError("");
          const res = await fetch(`${API_BASE}/favorites`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ placeId: place.id, placeName: place.name }),
          });
          if (!res.ok) throw new Error("ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");
          const data = await res.json();
          setFavorites(data);
        } catch (e) {
          console.error("POST /favorites error:", e);
          setError("ì¦ê²¨ì°¾ê¸°ë¥¼ ì €ì¥í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="container">
          <div className="header-row">
            <div>
              <h1>
                êµ°ì‚° ê´€ê´‘ì§€ ì¦ê²¨ì°¾ê¸°
                <span className="tag">
                  <span className="tag-dot" />
                  React Â· MongoDB
                </span>
              </h1>
              <p className="subtitle">
                êµ°ì‚°ì˜ ì£¼ìš” ê´€ê´‘ì§€ë¥¼ Reactë¡œ ë Œë”ë§í•˜ê³ , Node.js + MongoDBë¥¼ ì´ìš©í•´
                ì°œ(ì¦ê²¨ì°¾ê¸°) íšŸìˆ˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
              </p>
            </div>
            <div className="header-right">
              ì´ ì°œ ìˆ˜ <strong>{totalLikes}</strong>íšŒ<br />
              ê¸°ë¡ëœ ê´€ê´‘ì§€ ìˆ˜ <strong>{favorites.length}</strong>ê°œ
            </div>
          </div>

          {loading && <div className="status">â³ ì„œë²„ì™€ í†µì‹  ì¤‘...</div>}
          {error && <div className="error">{error}</div>}

          <div className="layout">
            {/* ì™¼ìª½: ê´€ê´‘ì§€ ì¹´ë“œ ëª©ë¡ */}
            <div>
              <h3 className="section-title">ê´€ê´‘ì§€ ëª©ë¡</h3>
              <p className="section-desc">
                ë§ˆìŒì— ë“œëŠ” ì¥ì†Œë¥¼ <span className="highlight">â­ ì°œí•˜ê¸°</span> í•˜ë©´,
                ì˜¤ë¥¸ìª½ì— ì¸ê¸° ê´€ê´‘ì§€ ìˆœìœ„ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
              </p>

              <div className="place-list">
                {PLACES.map((p) => (
                  <div className="place-card" key={p.id}>
                    <div className="place-name">{p.name}</div>
                    <div className="place-desc">{p.desc}</div>
                    <div className="place-meta">
                      <span className="pin">ğŸ“</span>{p.area}
                    </div>
                    <div className="place-likes">
                      <span className="likes-pill">
                        <span className="dot" />
                        í˜„ì¬ ì°œ ìˆ˜: {getLikesForPlace(p.name)}íšŒ
                      </span>
                    </div>
                    <div className="btn-row">
                      <button
                        type="button"
                        onClick={() => handleFavorite(p)}
                        disabled={loading}
                      >
                        <span className="icon">â­</span>
                        ì°œí•˜ê¸°
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* ì˜¤ë¥¸ìª½: ì¸ê¸° ìˆœìœ„ */}
            <div>
              <div className="ranking-card">
                <h3 className="ranking-title">ì¸ê¸° ê´€ê´‘ì§€ Top</h3>
                <p className="ranking-sub">
                  MongoDBì— ì €ì¥ëœ ì°œ ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•©ë‹ˆë‹¤.
                </p>
                {favorites.length === 0 ? (
                  <p style={{ fontSize: "0.85rem", color: "#6b7280" }}>
                    ì•„ì§ ì°œí•œ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ê´€ê´‘ì§€ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”!
                  </p>
                ) : (
                  <ul className="ranking-list">
                    {favorites.map((f, idx) => (
                      <li className="ranking-item" key={f._id || f.placeId}>
                        <div className="ranking-left">
                          <span
                            className={
                              "rank-badge " +
                              (idx === 0
                                ? "rank-1"
                                : idx === 1
                                ? "rank-2"
                                : idx === 2
                                ? "rank-3"
                                : "")
                            }
                          >
                            {idx + 1}
                          </span>
                          <span>{f.placeName}</span>
                        </div>
                        <span className="ranking-count">
                          {f.likes}íšŒ <small>ì°œ</small>
                        </span>
                      </li>
                    ))}
                  </ul>
                )}

                <div className="ranking-footer">
                  ì´ ì°œ ìˆ˜: <strong>{totalLikes}</strong>íšŒ
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<FavoritesApp />);
  </script>
</body>
</html>
